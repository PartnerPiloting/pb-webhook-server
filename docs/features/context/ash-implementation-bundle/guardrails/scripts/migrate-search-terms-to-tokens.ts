import { PrismaClient } from "@prisma/client"; import { normaliseAndCanonise } from "../src/lib/tags"; const prisma = new PrismaClient();
async function main() { const batch = 500; let skip = 0; while (true) { const leads = await prisma.lead.findMany({ skip, take: batch, select: { id:true, searchTerms:true } }); if (leads.length === 0) break; for (const lead of leads) { const raw = (lead as any).searchTerms || ""; const { tokens } = normaliseAndCanonise(raw); await prisma.lead.update({ where: { id: lead.id }, data: { tokens } }); } skip += batch; console.log(`Processed ${skip}`); } console.log("Done."); } main().finally(() => prisma.$disconnect());